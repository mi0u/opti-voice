<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three-Signal Communication</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="settings-panel.css">
    <link rel="stylesheet" href="calibration.css">
</head>
<body>
    <!-- Calibration Screen -->
    <div class="calibration-screen" id="calibrationScreen" style="display: none;">
        <div class="calibration-container">
            <h1 id="calibrationTitle">Î’Î±Î¸Î¼Î¿Î½ÏŒÎ¼Î·ÏƒÎ· Eye Tracking</h1>
            <div class="calibration-instructions" id="calibrationInstructions">
                <p id="calibrationText">ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸Î±Ï„Îµ! Î ÏÎ­Ï€ÎµÎ¹ Î½Î± Î²Î±Î¸Î¼Î¿Î½Î¿Î¼Î®ÏƒÎ¿Ï…Î¼Îµ Ï„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î±.</p>
            </div>
            <div class="calibration-arrow" id="calibrationArrow" style="display: none;">
                <span id="arrowIcon">â†‘</span>
            </div>
            <div class="calibration-status" id="calibrationStatus"></div>
            <button class="calibration-btn" id="calibrationBtn">ÎˆÎ½Î±ÏÎ¾Î· Î’Î±Î¸Î¼Î¿Î½ÏŒÎ¼Î·ÏƒÎ·Ï‚ Î Î‘ÎÎ©</button>
        </div>
    </div>

    <div class="gaze-indicator" id="gazeIndicator">ğŸ¯ Initializing...</div>
    <video class="video-preview" id="videoPreview" autoplay playsinline></video>
    <canvas class="eye-visualization" id="eyeVisualization" width="400" height="200"></canvas>

    <!-- Settings Panel Toggle Button -->
    <button class="settings-toggle-btn" id="settingsToggleBtn">âš™ï¸ Settings</button>

    <!-- Help Button -->
    <button class="help-toggle-btn" id="helpToggleBtn">â“ Help</button>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <h3>Eye Tracking Settings</h3>

        <div class="setting-group">
            <label for="upThreshold">
                Up Threshold: <span id="upValue">0.60</span>
            </label>
            <input type="range" id="upThreshold" min="0.01" max="1.5" step="0.01" value="0.60">
            <small>Look up sensitivity (0.1 = easy, 1.5 = hard)</small>
        </div>

        <div class="setting-group">
            <label for="downThreshold">
                Down Threshold: <span id="downValue">0.60</span>
            </label>
            <input type="range" id="downThreshold" min="0.01" max="1.5" step="0.01" value="0.60">
            <small>Look down sensitivity (0.1 = easy, 1.5 = hard)</small>
        </div>

        <div class="setting-group">
            <label for="leftThreshold">
                Left Threshold: <span id="leftValue">0.60</span>
            </label>
            <input type="range" id="leftThreshold" min="0.01" max="1.5" step="0.01" value="0.60">
            <small>Look left sensitivity (0.1 = easy, 1.5 = hard)</small>
        </div>

        <div class="setting-group">
            <label for="rightThreshold">
                Right Threshold: <span id="rightValue">0.60</span>
            </label>
            <input type="range" id="rightThreshold" min="0.01" max="1.5" step="0.01" value="0.60">
            <small>Look right sensitivity (0.1 = easy, 1.5 = hard)</small>
        </div>

        <div class="setting-group">
            <label for="holdDuration">
                Hold Duration: <span id="holdValue">500</span>ms
            </label>
            <input type="range" id="holdDuration" min="100" max="2000" step="50" value="500">
            <small>How long to hold gaze (100-2000ms)</small>
        </div>

        <div class="setting-group">
            <label for="stabilityFrames">
                Stability Frames: <span id="stabilityValue">5</span>
            </label>
            <input type="range" id="stabilityFrames" min="2" max="10" step="1" value="5">
            <small>How stable direction must be (2-10 frames)</small>
        </div>

        <div class="setting-group">
            <label for="smoothingFactor">
                Smoothing Factor: <span id="smoothingValue">0.80</span>
            </label>
            <input type="range" id="smoothingFactor" min="0.1" max="0.9" step="0.01" value="0.8">
            <small>Reduce jitter (0.1 = responsive, 0.9 = smooth)</small>
        </div>

        <div class="setting-group">
            <label class="toggle-label">
                <input type="checkbox" id="eyeViewToggle" checked>
                <span>Show Eye Visualization</span>
            </label>
        </div>

        <div class="setting-group">
            <label class="toggle-label">
                <input type="checkbox" id="soundToggle" checked>
                <span>Sound on Detection</span>
            </label>
        </div>

        <button class="reset-btn" id="resetBtn">Reset to Defaults</button>
        <button class="reset-btn" id="recalibrateBtn" style="margin-top: 10px; background: #2196F3;">Re-calibrate Thresholds</button>
        <small class="help-text">Press 'O' key to log current eye tracking values to console</small>
    </div>

    <!-- Help Panel -->
    <div class="help-panel" id="helpPanel">
        <div class="help-content">
            <h3>â“ Helper's Guide</h3>

            <div class="help-section">
                <h4>ğŸ“– How This App Works</h4>
                <p>This app lets the user communicate by looking at different areas of the screen. The camera tracks their eye movements to select letters, words, and commands.</p>
                <ul>
                    <li><strong>Look Left:</strong> Select items from the left column</li>
                    <li><strong>Look Right:</strong> Select items from the right column</li>
                    <li><strong>Look Up:</strong> Access special menu or go back</li>
                    <li><strong>Look Down:</strong> Speak text or undo menu navigation</li>
                </ul>
            </div>

            <div class="help-section">
                <h4>ğŸ¯ About Calibration</h4>
                <p><strong>What it is:</strong> Calibration teaches the system to recognize the user's specific eye movements (up, down, left, right).</p>
                <p><strong>Why it's needed:</strong> Every person's eyes are different. Calibration creates a personalized baseline for accurate tracking.</p>
                <p><strong>âš ï¸ Important:</strong> After calibration, the user's head position and screen position should remain unchanged. Moving the head or screen will require re-calibration for accurate tracking.</p>
            </div>

            <div class="help-section">
                <h4>ğŸ”§ Fine-Tuning Settings</h4>
                <p>Even after calibration, the system may need adjustment. Use the Settings panel to optimize performance:</p>
                <ul>
                    <li><strong>Direction Thresholds (Up/Down/Left/Right):</strong> How far the user must look to trigger detection. Lower = easier to trigger, Higher = harder to trigger.</li>
                    <li><strong>Hold Duration:</strong> How long the user must hold their gaze (100-2000ms). Shorter = faster but may trigger accidentally.</li>
                    <li><strong>Stability Frames:</strong> How steady the gaze must be (2-10 frames). Lower = more responsive, Higher = more stable.</li>
                    <li><strong>Smoothing Factor:</strong> Reduces jitter in detection (0.1 = responsive, 0.9 = smooth).</li>
                </ul>
                <p><em>ğŸ’¡ Tip: If selections trigger too easily, increase thresholds. If they're too hard, decrease thresholds.</em></p>
            </div>

            <div class="help-section">
                <h4>ğŸ”„ Re-calibration</h4>
                <p>Click "Re-calibrate Thresholds" in Settings if:</p>
                <ul>
                    <li>The user's position has changed</li>
                    <li>The screen has been moved</li>
                    <li>Accuracy has decreased</li>
                </ul>
            </div>

            <button class="help-close-btn" id="helpCloseBtn">âœ– Close</button>
        </div>
    </div>

    <div class="container">
        <div class="instructions">
            <strong>Look Left</strong> Select Left & Continue | <strong>Look Right</strong> Select Right & Continue | <strong>Look Up</strong> Special Menu / Back | <strong>Look Down</strong> Speech / menu undo
        </div>

        <div class="mode-indicator" id="modeIndicator">Letter Selection Mode</div>

        <!-- Result Viewer (hidden by default) -->
        <div class="result-viewer" id="resultViewer" style="display: none;">
            <div class="result-viewer-header">
                <div class="result-viewer-title" id="resultViewerTitle">Loading...</div>
                <div class="result-viewer-back">ğŸ‘† Up to Return | â¬…ï¸ Scroll Up | â¡ï¸ Scroll Down</div>
            </div>
            <div class="result-content" id="resultContent"></div>
        </div>

        <div class="menu-container" id="menuContainer">
            <div class="column" id="leftColumn"></div>
            <div class="column" id="rightColumn"></div>
        </div>

        <div class="text-area-container">
            <textarea class="text-area" id="textArea" readonly placeholder="Your text will appear here..."></textarea>
        </div>
    </div>

    <!-- Configuration -->
    <script src="config.js?v=4.4"></script>

    <!-- Database -->
    <script src="database.js?v=4.4"></script>

    <!-- Utilities -->
    <script src="suggestions.js?v=4.4"></script>
    <script src="storage.js?v=4.4"></script>

    <!-- Features -->
    <script src="menus.js?v=4.4"></script>
    <script src="search.js?v=4.4"></script>
    <script src="actions.js?v=4.4"></script>
    <script type="module" src="eyetracking.js?v=4.4"></script>
    <script src="settings.js?v=4.4"></script>

    <!-- Main Application -->
    <script src="main.js?v=4.4"></script>
</body>
</html>
